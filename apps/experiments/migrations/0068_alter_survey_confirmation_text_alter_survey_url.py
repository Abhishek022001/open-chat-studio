# Generated by Django 4.2.7 on 2024-03-05 10:42

from django.db import migrations, models


def update_post_survey_text(apps, schema_editor):
    def _is_post_survey(survey_name: str) -> bool:
        return "post" in survey_name and "pre" not in survey_name

    Survey = apps.get_model("experiments", "Survey")
    for survey in Survey.objects.all():
        if _is_post_survey(survey.name.lower()):
            survey.confirmation_text = (
                "As a final step, please complete the survey linked below. When you have finished,"
                " return to this screen to continue."
            )
            survey.save()


class Migration(migrations.Migration):
    dependencies = [
        ("experiments", "0067_experiment_voice_response_behaviour"),
    ]

    operations = [
        migrations.AlterField(
            model_name="survey",
            name="confirmation_text",
            field=models.TextField(
                default="Please complete the following survey by clicking on the survey link. When you have finished, respond with '1' to let us know that you've completed it. Survey link: {survey_link}"
            ),
        ),
        migrations.AlterField(
            model_name="survey",
            name="url",
            field=models.URLField(max_length=500),
        ),
        migrations.RunPython(update_post_survey_text, reverse_code=migrations.RunPython.noop),
    ]
